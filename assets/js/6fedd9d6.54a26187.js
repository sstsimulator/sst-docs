"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1571],{28453:(n,e,l)=>{l.d(e,{R:()=>o,x:()=>r});var i=l(96540);const s={},t=i.createContext(s);function o(n){const e=i.useContext(t);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:o(n.components),i.createElement(t.Provider,{value:e},n.children)}},60878:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"elements/vanadis/compiler","title":"Compiler toolchains","description":"Vanadis has been tested with two compiler toolchains: musl and llvm/riscv-gnu-toolchain. musl works for MIPS and RV64 while clang works for RV64 only. All binaries must be statically linked.","source":"@site/../docs/elements/vanadis/compiler.md","sourceDirName":"elements/vanadis","slug":"/elements/vanadis/compiler","permalink":"/sst-docs/docs/elements/vanadis/compiler","draft":false,"unlisted":false,"editUrl":"https://github.com/sstsimulator/sst-docs/edit/master/docs/../docs/elements/vanadis/compiler.md","tags":[],"version":"current","lastUpdatedBy":"grvosku","lastUpdatedAt":1762293106000,"frontMatter":{"title":"Compiler toolchains"},"sidebar":"elements","previous":{"title":"vanadis","permalink":"/sst-docs/docs/elements/vanadis/intro"},"next":{"title":"vaultsim","permalink":"/sst-docs/docs/elements/vaultsim/intro"}}');var s=l(74848),t=l(28453);const o={title:"Compiler toolchains"},r=void 0,c={},a=[{value:"MUSL Toolchain",id:"musl-toolchain",level:2},{value:"LLVM/RISCV-gnu-toolchain",id:"llvmriscv-gnu-toolchain",level:2},{value:"Compiling for Vanadis",id:"compiling-for-vanadis",level:2}];function d(n){const e={a:"a",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(e.p,{children:["Vanadis has been tested with two compiler toolchains: ",(0,s.jsx)(e.a,{href:"https://musl.libc.org/",children:"musl"})," and ",(0,s.jsx)(e.a,{href:"https://llvm.org/",children:"llvm"}),"/",(0,s.jsx)(e.a,{href:"https://github.com/riscv-collab/riscv-gnu-toolchain",children:"riscv-gnu-toolchain"}),". ",(0,s.jsx)(e.em,{children:"musl"})," works for MIPS and RV64 while clang works for RV64 only. All binaries must be statically linked."]}),"\n",(0,s.jsx)(e.p,{children:"Threading and GPU support:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.em,{children:"CUDA"}),": use the llvm-based toolchain (see ",(0,s.jsx)(e.a,{href:"/sst-docs/docs/elements/balar/intro",children:"balar"}),")"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.em,{children:"OpenMP"}),": use the ",(0,s.jsx)(e.em,{children:"musl"})," OpenMP library"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.em,{children:"pthreads"}),": works under both toolchains"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"musl-toolchain",children:"MUSL Toolchain"}),"\n",(0,s.jsxs)(e.p,{children:["Refer to the ",(0,s.jsx)(e.a,{href:"https://musl.libc.org/",children:"musl project"})," for installation and download instructions."]}),"\n",(0,s.jsx)(e.h2,{id:"llvmriscv-gnu-toolchain",children:"LLVM/RISCV-gnu-toolchain"}),"\n",(0,s.jsxs)(e.p,{children:["To install this toolchain, download ",(0,s.jsx)(e.a,{href:"https://llvm.org/",children:"llvm"})," and the ",(0,s.jsx)(e.a,{href:"https://github.com/riscv-collab/riscv-gnu-toolchain",children:"riscv-gnu-toolchain"}),"."]}),"\n",(0,s.jsx)(e.p,{children:"Follow the instructions below. Refer to llvm and the riscv-gnu-toolchain instructions for any dependencies you may need to acquire. For riscv-gnu-toolchain, build the linux (not newlib) version."}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:'# Create installation dirs\nmkdir llvm-install\nmkdir riscv-gnu-install\n\n# Set up environment vars to LLVM and RISCV gnu installation folders\nexport LLVM_INSTALL_PATH=$(pwd)/llvm-install\nexport RISCV_TOOLCHAIN_INSTALL_PATH=$(pwd)/riscv-gnu-install\n\n# Build LLVM with desired support\n# -DLLVM_TARGETS_TO_BUILD="RISCV" : RISCV only for vanadis\n# -DLLVM_TARGETS_TO_BUILD="RISCV;NVPTX" : Add cuda support for balar/vanadis\ngit clone https://github.com/llvm/llvm-project.git\n\ncd llvm-project\nmkdir build && cd build\ncmake -DLLVM_TARGETS_TO_BUILD="RISCV" -DLLVM_DEFAULT_TARGET_TRIPLE=riscv64-unknown-linux-gnu \\\n      -DCMAKE_BUILD_TYPE=Release -DLLVM_ENABLE_PROJECTS="clang;lld" -DCMAKE_INSTALL_PREFIX=$LLVM_INSTALL_PATH ../llvm\ncmake --build . -j\ncmake --build . --target install\ncd ..\n\n# Build RISC-V GCC toolchain\ngit clone https://github.com/riscv-collab/riscv-gnu-toolchain.git\n\ncd riscv-gnu-toolchain\n./configure --prefix=$RISCV_INSTALL_PATH\nmake linux -j\ncd ..\n'})}),"\n",(0,s.jsx)(e.h2,{id:"compiling-for-vanadis",children:"Compiling for Vanadis"}),"\n",(0,s.jsxs)(e.p,{children:["To compile for vanadis, set ",(0,s.jsx)(e.code,{children:"CC"})," and/or ",(0,s.jsx)(e.code,{children:"CXX"})," to point to the cross-compiler you built above. Ensure linking is done statically. There are a number of Makefiles in the vanadis ",(0,s.jsx)(e.code,{children:"tests/small/"})," directory that can be used as examples for musl. Below are Makefiles that can be used to build ",(0,s.jsx)(e.code,{children:"vanadis/tests/small/basic-io/hello-world-cpp/hello-world-cpp.cc"}),"."]}),"\n",(0,s.jsxs)(e.p,{children:["This makefile uses the musl compiler and requires that ",(0,s.jsx)(e.code,{children:"ARCH"})," be set to either ",(0,s.jsx)(e.code,{children:"mipsel"})," to build a mips binary or ",(0,s.jsx)(e.code,{children:"riscv64"})," for RISCV. The musl compiler must be in your ",(0,s.jsx)(e.code,{children:"PATH"}),"."]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",metastring:'title="Building hello-world-cpp using the musl compiler"',children:"CXX=$(ARCH)-linux-musl-g++\n\nCFLAGS=-O3\nCXXFLAGS=-O3\nLDFLAGS=-static\n\nPROG=hello-world-cpp\n\n$(PROG) : $(PROG).cc\n        $(CXX) $(CFLAGS) $(LDFLAGS) -o $(ARCH)/$@ $<\n\nclean:\n        rm -r $(ARCH)/$(PROG)\n"})}),"\n",(0,s.jsxs)(e.p,{children:["This makefile uses the llvm toolchain and requires that ",(0,s.jsx)(e.code,{children:"RISCV_TOOLCHAIN_INSTALL_PATH"})," and ",(0,s.jsx)(e.code,{children:"LLVM_INSTALL_PATH"})," be set, as described in the installation instructions. This makefile does not require llvm to be in your ",(0,s.jsx)(e.code,{children:"PATH"}),"."]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",metastring:'title="Building hello-world-cpp using clang compiler"',children:"RISCV_SYSROOT := $(RISCV_TOOLCHAIN_INSTALL_PATH)/sysroot\n\nCXXFLAGS := --unwindlib=libgcc --gcc-toolchain=$(RISCV_TOOLCHAIN_INSTALL_PATH)\nCXXFLAGS += --sysroot=$(RISCV_SYSROOT) -I$(RISCV_SYSROOT)/usr/include \nCXXFLAGS += --target=riscv64-unknown-linux-gnu -march=rv64gc -mabi=lp64d\n\nCXX := $(LLVM_INSTALL_PATH)/bin/clang++\n\nLDFLAGS := -static -static-libstdc++ -static-libgcc\nLDFLAGS += -Wl,-rpath,$(RISCV_SYSROOT)/lib64:$(RISCV_SYSROOT)/usr/lib64\n\nPROG=hello-world-cpp\n\n$(PROG) : $(PROG).cc\n        $(CXX) $(CXXFLAGS) $(LDFLAGS) -o $@ $<\n\nclean:\n        rm -r $(PROG)\n"})})]})}function h(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}}}]);