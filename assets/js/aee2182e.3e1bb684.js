"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7108],{29859:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>s,metadata:()=>a,toc:()=>m});var i=t(74848),r=t(28453);const s={title:"QuickStart Motif Guide"},o=void 0,a={id:"elements/ember/QuickStart",title:"QuickStart Motif Guide",description:"What is an Ember motif?",source:"@site/../docs/elements/ember/QuickStart.md",sourceDirName:"elements/ember",slug:"/elements/ember/QuickStart",permalink:"/sst-docs/docs/elements/ember/QuickStart",draft:!1,unlisted:!1,editUrl:"https://github.com/sstsimulator/sst-docs/edit/master/docs/../docs/elements/ember/QuickStart.md",tags:[],version:"current",lastUpdatedBy:"grvosku",lastUpdatedAt:169594075e4,frontMatter:{title:"QuickStart Motif Guide"},sidebar:"elements",previous:{title:"ember",permalink:"/sst-docs/docs/elements/ember/intro"},next:{title:"Creating Motifs",permalink:"/sst-docs/docs/elements/ember/CreatingMotifs"}},l={},m=[{value:"What is an Ember motif?",id:"what-is-an-ember-motif",level:2},{value:"Quick Start Guide",id:"quick-start-guide",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"what-is-an-ember-motif",children:"What is an Ember motif?"}),"\n",(0,i.jsx)(n.p,{children:"Ember Motifs are a high-level representation of a workload's communication patterns. They are used to estimate performance on hardware at scale in SST simulations.\nThis guide provides a directions on how to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Implement a empty motif."}),"\n",(0,i.jsx)(n.li,{children:"Create and run motif in a SST simulation."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Implementing and running Ember Motifs requires three different files:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"../../config/",children:"Configuration"})}),"\n",(0,i.jsx)(n.p,{children:"A Python file that provides information on the hardware to be simulated when running an Ember Motif\nThis directs SST on the available hardware components and how they are set up."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"C++ file"}),"\n",(0,i.jsx)(n.p,{children:"Decides how the computation is structured and computed."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"C++ header file"}),"\n",(0,i.jsx)(n.p,{children:"The header file contains primarily naming information"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"quick-start-guide",children:"Quick Start Guide"}),"\n",(0,i.jsx)(n.p,{children:"This guide gives a simple example of how to create and run a simple Motif."}),"\n",(0,i.jsxs)(n.p,{children:["First ensure SST-core and SST-elements are properly installed on your machine. For download and installation see ",(0,i.jsx)(n.a,{href:"http://sst-simulator.org/SSTPages/SSTMainDownloads/",children:"SST-Downloads"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Navigate to ",(0,i.jsx)(n.code,{children:"sst-elements/src/elements/ember"})," inside the sst-elements library.\nFirst, create a new directory to hold our example Motif."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"$ mkdir ExampleMotif\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Next, create an ",(0,i.jsx)(n.code,{children:"ExampleMotif/example.h"})," file."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",metastring:'title="ExampleMotif/example.h"',children:'#ifndef _H_EMBER_EXAMPLE\n#define _H_EMBER_EXAMPLE\n\n#include "../../mpi/embermpigen.h"\n\nnamespace SST {\nnamespace Ember {\n\nclass ExampleGenerator : public EmberMessagePassingGenerator {\npublic:\n\n    SST_ELI_REGISTER_SUBCOMPONENT_DERIVED(\n        ExampleGenerator,\n        "ember",\n        "ExampleMotif",\n        SST_ELI_ELEMENT_VERSION(1,0,0),\n        "Performs an idle on the node, no traffic can be generated.",\n        SST::Ember::EmberGenerator\n    );\n\n    SST_ELI_DOCUMENT_STATISTICS(\n        { "time-Init", "Time spent in Init event",             "ns", 0},\n        { "time-Finalize", "Time spent in Finalize event",     "ns", 0},\n        { "time-Rank", "Time spent in Rank event",             "ns", 0},\n        { "time-Size", "Time spent in Size event",             "ns", 0},\n        { "time-Send", "Time spent in Recv event",             "ns", 0},\n        { "time-Recv", "Time spent in Recv event",             "ns", 0},\n        { "time-Irecv", "Time spent in Irecv event",           "ns", 0},\n        { "time-Isend", "Time spent in Isend event",           "ns", 0},\n        { "time-Wait", "Time spent in Wait event",             "ns", 0},\n        { "time-Waitall", "Time spent in Waitall event",       "ns", 0},\n        { "time-Waitany", "Time spent in Waitany event",       "ns", 0},\n        { "time-Compute", "Time spent in Compute event",       "ns", 0},\n        { "time-Barrier", "Time spent in Barrier event",       "ns", 0},\n        { "time-Alltoallv", "Time spent in Alltoallv event",   "ns", 0},\n        { "time-Alltoall", "Time spent in Alltoall event",     "ns", 0},\n        { "time-Allreduce", "Time spent in Allreduce event",   "ns", 0},\n        { "time-Reduce", "Time spent in Reduce event",         "ns", 0},\n        { "time-Bcast", "Time spent in Bcast event",           "ns", 0},\n        { "time-Gettime", "Time spent in Gettime event",       "ns", 0},\n        { "time-Commsplit", "Time spent in Commsplit event",   "ns", 0},\n        { "time-Commcreate", "Time spent in Commcreate event", "ns", 0},\n    );\n\n    ExampleGenerator( SST::ComponentId_t id, Params& params );\n    bool generate( std::queue<EmberEvent*>& evQ );\n};\n}\n}\n\n#endif /* _H_EMBER_EXAMPLE */\n'})}),"\n",(0,i.jsx)(n.p,{children:"This creates a Motif generator class called ExampleGenerator that inherits from EmberMessagePassingGenerator. The Python code we provide later creates and invokes the generate function.\nThe SST Document Statistics provides tracking for initialization and various MPI function calls."}),"\n",(0,i.jsx)(n.p,{children:"Motifs are executed as follows:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"The motif generator is initialized (the constructor)."}),"\n",(0,i.jsx)(n.li,{children:"The generate function is invoked and returns either true or false."}),"\n",(0,i.jsx)(n.li,{children:"The events on the eventQueue are processed."}),"\n",(0,i.jsx)(n.li,{children:"If the generate function in step 2 returned false, return to step 2, otherwise the motif is complete."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"To complete the motif example, we create the file ExampleMotif/example.cc as shown below. This motif returns without doing any work."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",metastring:'title="ExampleMotif/example.cc"',children:'#include <sst_config.h>\n#include "example.h"\n\nusing namespace SST::Ember;\n    \nExampleGenerator::ExampleGenerator(SST::ComponentId_t id, Params& params) :\n    EmberMessagePassingGenerator(id, params, "Null" )\n{\n}\n\nbool ExampleGenerator::generate( std::queue<EmberEvent*>& evQ)\n{ \n    // Code here is repeated until true is returned. \n    return true;\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Motifs are intended to be run as a 'job submission'.\nThe generate function models an entire iteration of an application. The event queue allows the motif to mix compute and MPI operations in every iteration."}),"\n",(0,i.jsxs)(n.p,{children:["The C++ file loads the SST",":Ember"," namespace giving it access to other Motifs and EmberEvents.\nEach Motif generator has an constructor and generate function."]}),"\n",(0,i.jsxs)(n.p,{children:["Then we add the ",(0,i.jsx)(n.code,{children:".cc"})," and ",(0,i.jsx)(n.code,{children:".h"})," file to ",(0,i.jsx)(n.code,{children:"Makefile.am"})]}),"\n",(0,i.jsx)(n.p,{children:"i.e."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",metastring:'title="Makefile.am"',children:"    ...\n    embermemoryev.h \\\n    #highlight-start\n    ExampleMotif/example.h \\\n    ExampleMotif/example.cc \\\n    #highlight-end\n    libs/emberLib.h \\\n    ...\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Finally, a Python file, ",(0,i.jsx)(n.code,{children:"example.py"}),", needs to be created:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-py",metastring:'title="example.py"',children:'import sst\nfrom sst.merlin.base import *\nfrom sst.merlin.endpoint import *\nfrom sst.merlin.interface import *\nfrom sst.merlin.topology import *\n\nfrom sst.ember import *\n\ndef example():\n    PlatformDefinition.setCurrentPlatform("firefly-defaults")\n\n    ### Setup the topology\n    topo = topoDragonFly()\n    topo.hosts_per_router = 2\n    topo.routers_per_group = 4\n    topo.intergroup_links = 2\n    topo.num_groups = 4\n    topo.algorithm = ["minimal","adaptive-local"]\n\n    # Set up the routers\n    router = hr_router()\n    router.link_bw = "4GB/s"\n    router.flit_size = "8B"\n    router.xbar_bw = "6GB/s"\n    router.input_latency = "20ns"\n    router.output_latency = "20ns"\n    router.input_buf_size = "4kB"\n    router.output_buf_size = "4kB"\n    router.num_vns = 2\n    router.xbar_arb = "merlin.xbar_arb_lru"\n\n    topo.router = router\n    topo.link_latency = "20ns"\n\n    ### set up the endpoint\n    networkif = ReorderLinkControl()\n    networkif.link_bw = "4GB/s"\n    networkif.input_buf_size = "1kB"\n    networkif.output_buf_size = "1kB"\n\n    ep = EmberMPIJob(0,topo.getNumNodes())\n    ep.network_interface = networkif\n    ep.addMotif("Init")\n    ep.addMotif("Example")\n    ep.addMotif("Fini")\n    ep.nic.nic2host_lat= "100ns"\n\n    system = System()\n    system.setTopology(topo)\n    system.allocateNodes(ep,"linear")\n\n    system.build()\n\nif __name__ == "__main__":\n    example()\n'})}),"\n",(0,i.jsx)(n.p,{children:'This follows common Python syntax.\nThe hardware variables (topology, router and network interface) are created through assignment of a constructor\nThe fields of the variables are accessed using a dot operator.\nTopology, router, and network interface variables need to be created for a simulation. More detailed descriptions of configuration options is in RunningMotifs.md.\nNext an endpoint is created and given the motif to be used using a ep.addMotif("MotifName") call\nNote multiple motifs can be added the same endpoint. The intended use for each motif to simulate an entire application. The event queue is used to simulate MPI events and computational workloads. Adding multiple motifs is useful for simulating workflows of a series of applications.'}),"\n",(0,i.jsx)(n.p,{children:"Finally, a system variable is created and 'built'."}),"\n",(0,i.jsxs)(n.p,{children:["Re-run ",(0,i.jsx)(n.code,{children:"autogen.sh"})," and then re-build SST-elements."]}),"\n",(0,i.jsxs)(n.p,{children:["To run the Python script, pass it to ",(0,i.jsx)(n.code,{children:"sst"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"$ sst example.py\nSimulation is complete, simulated time: 0 s\n"})})]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var i=t(96540);const r={},s=i.createContext(r);function o(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);